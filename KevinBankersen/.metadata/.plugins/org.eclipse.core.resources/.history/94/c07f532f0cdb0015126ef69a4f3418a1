package eu.bankersen.kevin.ql.interpreter;


import java.util.ArrayList;
import java.util.List;

import com.esotericsoftware.minlog.Log;

import eu.bankersen.kevin.ql.ast.form.Form;
import eu.bankersen.kevin.ql.context.SymbolTable;
import eu.bankersen.kevin.ql.util.testing.DataListener;
import eu.bankersen.kevin.ql.util.testing.ViewListener;

public class Interpreter implements ViewListener {

    private final Form form;
    public SymbolTable symbolTable;
    private List<DataListener> dataListeners;

    public Interpreter(Form form, SymbolTable symbolTable) {
	this.form = form;
	this.symbolTable = symbolTable;
	this.dataListeners = new ArrayList<>();
    }

    public void addDataListener(DataListener listener) {
	dataListeners.add(listener);
    }

    private void dataUpdate() {
	Log.info("Fire Data Event");
	dataListeners.forEach(listener -> listener.dataUpdate(symbolTable));
    }

    @Override
    public void viewUpdate(String name, Object value) {
	Log.info("Inside Interpreter: " + value);
	symbolTable.updateSymbol(name, value);
	SymbolTable update = form.evalForm(this.symbolTable);
	Log.info("Eval Ran");
	dataUpdate();
    }
}
