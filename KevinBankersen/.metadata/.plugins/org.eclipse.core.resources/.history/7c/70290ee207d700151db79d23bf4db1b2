package eu.bankersen.kevin.ql.ast;

import com.esotericsoftware.minlog.Log;

import eu.bankersen.kevin.ql.ast.expr.Expr;
import eu.bankersen.kevin.ql.context.Context;
import eu.bankersen.kevin.ql.context.Context2;
import eu.bankersen.kevin.ql.context.EvaluateExeption;

public class Variable {

    private final String name;
    private final Type type;
    private final int line;
    private Expr expr;

    public Variable(String name, Type type, Expr expr, int line) {
	context = Context2.getInstance();
	this.name = name;
	this.type = type;
	this.expr = expr;
	this.line = line;
    }

    public String getName() {
	return name;
    }

    public Type getType() {
	return type;
    }

    public Context checkType(Context context) {

	System.out.println("1");
	if (context.checkID(name)) {
	    context.addError("TYPE_ERROR @Line " + line 
		    			+ " question " + name + " already defined!");
	} else {
	    context.addSymbol(name, type);
	}

	context = expr.checkType(context);
	
	if (!expr.getType(context).equals(type)) {
	    context.addError("TYPE_ERROR @Line " + line 
		    			+ ": expected " + type 
		    			+ " got " + expr.getType(context) + "!");
	}
	return context;
    }



    public String toString() {
	return this.getName() + ": " + this.getType() + "=" + this.getValue();
    }

    public void eval(Context context) {

	try {
	    Object value = expr.eval();
	    context.updateSymbol(name, value);
	} catch (EvaluateExeption  e) {
	    Log.debug("Cannot evaluate expression yet");
	}
    }
}
