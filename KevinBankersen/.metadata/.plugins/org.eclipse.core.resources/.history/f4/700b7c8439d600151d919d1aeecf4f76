package eu.bankersen.kevin.ql.parser;

import com.esotericsoftware.minlog.Log;

import eu.bankersen.kevin.ql.ast.form.Form;
import eu.bankersen.kevin.ql.parser.QLParser.FormContext;

import java.util.BitSet;

import org.antlr.v4.runtime.ANTLRErrorListener;
import org.antlr.v4.runtime.ANTLRInputStream;
import org.antlr.v4.runtime.CommonTokenStream;
import org.antlr.v4.runtime.Parser;
import org.antlr.v4.runtime.RecognitionException;
import org.antlr.v4.runtime.Recognizer;
import org.antlr.v4.runtime.atn.ATNConfigSet;
import org.antlr.v4.runtime.dfa.DFA;

public class FormParser {


    private final String input;
    private FormContext formContext;
    private QLParser parser;


    public FormParser(final String input) {
	this.input = input;
	parse();
    }


    private void parse() {

	Log.info("Parsing File");

	ANTLRInputStream antlrStream = new ANTLRInputStream(input);

	QLLexer lexer = new QLLexer(antlrStream);

	CommonTokenStream tokenStream = new CommonTokenStream(lexer);

	parser = new QLParser(tokenStream);
	
	ANTLRErrorListener listener = new ANTLRErrorListener() {
	    
	    @Override
	    public void syntaxError(Recognizer<?, ?> arg0, Object arg1, int arg2, int arg3, String arg4,
		    RecognitionException arg5) {
		System.out.println(arg1);
		System.out.println(arg2);
		System.out.println(arg3);
		System.out.println(arg4);
		System.out.println(arg5);
		
	    }
	    
	    @Override
	    public void reportContextSensitivity(Parser arg0, DFA arg1, int arg2, int arg3, int arg4, ATNConfigSet arg5) {
		// TODO Auto-generated method stub
		
	    }
	    
	    @Override
	    public void reportAttemptingFullContext(Parser arg0, DFA arg1, int arg2, int arg3, BitSet arg4, ATNConfigSet arg5) {
		// TODO Auto-generated method stub
		System.out.println(arg1);
	    }
	    
	    @Override
	    public void reportAmbiguity(Parser arg0, DFA arg1, int arg2, int arg3, boolean arg4, BitSet arg5,
		    ATNConfigSet arg6) {
		// TODO Auto-generated method stub
		
	    }
	};
	parser.addErrorListener(listener );

	formContext = parser.form();
	
    }


    public final FormContext getFormContext() {
	return formContext;
    }


    public final Form getForm() {
	return formContext.result;
    }


    public final int getParseErrors() {
	return parser.getNumberOfSyntaxErrors();
    }


    public final String[] getParseRules() {
	return parser.getRuleNames();
    }
}
